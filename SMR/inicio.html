<!DOCTYPE html>
<html>
    <head>
        <title></title>
        <meta charset="utf-8" />
        <link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
        <link href="styles/main.css" rel="stylesheet" />

        <script src="cordova.js"></script>
        <script src="kendo/js/jquery.min.js"></script>
        <script src="kendo/js/kendo.mobile.min.js"></script>
        <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=true"></script>

        <script src="scripts/login.js"></script>
        <script src="scripts/location.js"></script>
        <script src="scripts/weather.js"></script>
        <script src="scripts/app.js"></script>
    </head>
    <body>
        <div id="tabstrip-home" 
             data-title="Inicio" 
             data-role="view"
             data-layout ="tabstrip-layout"
             data-transition="fade"
             data-init="initHome"
             >
            <div data-role="header">
                <div data-role="navbar" style="background-color: black; color: white;">
                    <span data-role="view-title">Inicio</span>
                </div>
            </div>    
            
            <div class="indicators_container">
            	Venta y Cobro
                <div id="two_panel_container">
                    <div class="porcentaje_container">
                        <span id="vpor" class="porcentaje_label">00.0%</span>
                    </div>
                    <div class="porcentaje_container">
                        <span id="cpor" class="porcentaje_label">00.0%</span>
                    </div>
                </div>
            </div>
            
            <div id="week_container">
            	<ul data-role="buttongroup" data-index="0" data-select="onSelect">
                	<li>&nbsp;S01&nbsp;</li>
                	<li>&nbsp;S02&nbsp;</li>
                	<li>&nbsp;S03&nbsp;</li>
                	<li>&nbsp;S04&nbsp;</li>
            	</ul>
            </div>
            
            <div class="indicators_container">
                Avance de Venta 
                <div class="deitel_container" >
                    <table class="deitel_table">
                        <tr>
                            <td class="left_column">
                                Proyectado
                            </td>
                            <td class="right_column">
                                <label id="v1">L. 0.00</label>
                            </td>
                        </tr>
                        <tr>
                            <td class="left_column">
                                Ejecutado
                            </td>
                            <td class="right_column">
                                <label id="v2">L. 0.00</label>
                            </td>
                        </tr>
                        <tr>
                            <td class="left_column">
                                Diferencia
                            </td>
                            <td class="right_column">
                                <label id="v3">L. 0.00</label>
                            </td>
                        </tr>
                    </table>
                </div>
                Avance de Cobro 
                <div class="deitel_container">
                    <table class="deitel_table">
                        <tr>
                            <td class="left_column">
                                Proyectado
                            </td>
                            <td class="right_column">
                                <label id="c1">L. 0.00</label>
                            </td>
                        </tr>
                        <tr>
                            <td class="left_column">
                                Ejecutado
                            </td>
                            <td class="right_column">
                                <label id="c2">L. 0.00</label>
                            </td>
                        </tr>
                        <tr>
                            <td class="left_column">
                                Diferencia
                            </td>
                            <td class="right_column">
                                <label id="c3">L. 0.00</label>
                            </td>
                        </tr>
                    </table> 
                </div>
            </div>
            <script>
                function initHome(e) 
                {
                    callWebService("1") ;
                }
                
                function onSelect(e) 
                {
                    try
                    {
                        var index = this.current().index();
                        index = index + 1;
                        callWebService(String(index)) ;
                    }
                    catch(err)
                    {
                        alert(err.toString());    
                    }
                    
                }
                function callWebService(semana)
                {
                    try
                    {
                        var vaType = "GET";
                        var vaUrl = "http://portal.diapa.net:120/SellsMachineRoom/Services/WS02.svc/Ejecutado_Contra_Vendido";
                        var vaData = 'Codigo=' + codigo + '&Tipo=' + String(tipo) + '&Semana=' + String(semana); 
                        var vaContentType = "application/json; charset=utf-8";
                        var vaDataType = "json";
                        var vaProcessData = true; 
                
                        $.ajax({
                        type          : vaType, //GET or POST or PUT or DELETE verb
                        url           : vaUrl, // Location of the service
                        data          : vaData, //Data sent to server
                        contentType   : vaContentType, // content type sent to server
                        dataType      : vaDataType, //Expected data format from server
                        processdata   : vaProcessData, //True or False
                        success       : function(msg) {//On Successfull service call
                            ServiceFind(msg);                    
                        },
                        error: ServiceNotFind// When Service call fails
                        });
                        
                        
                    }
                    catch(err)
                    {
                        alert(err.toString());
                    }
				}
                
                function ServiceFind(result) 
                {
                    try
                    {
                        var v1 = result.Proyectado_Venta;
                        var v2 = result.Ejecutado_Venta;
                        var v3 = v1 - v2;
                        var c1 = result.Proyectado_Cobro;
                        var c2 = result.Ejecutado_Cobro;
                        var c3 = c1 - c2;
                        var vpor = 0;
                        if( v1 != 0 )
                        {
                            vpor = ( v2 / v1 ) * 100.00;
                        }
                        
                        var cpor = 0;
                        if( c1 != 0 )
                        {
                            cpor = ( c2 / c1 ) * 100.00;
                        }
                        
                        document.getElementById("v1").innerHTML  = "L. " + String(v1.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,"));
                        document.getElementById("v2").innerHTML  = "L. " + String(v2.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,"));
                        document.getElementById("v3").innerHTML  = "L. " + String(v3.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,"));
                        
                        document.getElementById("c1").innerHTML  = "L. " +String(c1.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,"));
                        document.getElementById("c2").innerHTML  = "L. " +String(c2.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,"));
                        document.getElementById("c3").innerHTML  = "L. " + String(c3.toFixed(2).replace(/(\d)(?=(\d{3})+\.)/g, "$1,"));
                        
                        document.getElementById("vpor").innerHTML  = String(vpor.toFixed(2)) + "%";
                        document.getElementById("cpor").innerHTML  = String(cpor.toFixed(2)) + "%";
                        
                    }
                    catch(err)
                    {
                         alert(error.toString());   
                    }
                     
                }

                function ServiceNotFind(result) 
                {
                    alert("Error en conexi√≥n.");
                }
                
            </script>
        </div>   
        
        <div id="tabstrip-vendedores" 
             data-title="Vendedores" 
             data-role="view"
             data-layout ="tabstrip-layout"
             data-transition="fade"
             data-init="initVendedores"
             >
            <div data-role="header">
                <div data-role="navbar" style="background-color: black; color: white;">
                    <span data-role="view-title">Vendedores</span>
                	<a onClick="restart();" data-align="right" data-role="button" style="background-color: black; color: white;">Volver</a>
                </div>
            </div> 
            
            <ul id="custom-listview"  data-template="customListViewTemplate" data-role="listview"></ul>
            
            <script type="text/x-kendo-template" id="customListViewTemplate">
    			<div class="list_title">
                	<table style="width: 100%">
                    	<tr>
                        	<td style="width: 70%; text-align:left;">
            					${ID} - ${Name}
            				</td>
                            <td style="width: 70%; text-align:right;">
                    			<a class="button" data-role="button" onclick="listClick(${ID});" style="background-color: black; color: white; font-size:.8em;">Detalle</a>        
            				</td>
            			</tr>
            		</table>
                </div>
    			<div class="list_percentage">
            		<div class="template_label">Avance de Venta</div>
                    <div class="template_value">${per_venta}</div>
                </div>
                <div class="list_percentage">
                	<div class="template_label">Avance de Cobro</div>
                    <div class="template_value">${per_cobro}</div>
                </div>
                <br />
			</script>
            
            <script>
                function initVendedores(e) 
                {
                    callWebServiceList(codigo,getType(codigo));   
                }
                
                function restart() 
                {
                    callWebServiceList(codigo,getType(codigo));   
                }
                
                function callWebServiceList(codigo,tipo) 
            	{
                    try
                    {
                        var vType = "GET";
                        var vUrl = "http://portal.diapa.net:120/SellsMachineRoom/Services/WS03.svc/list";
                        var vData = 'Codigo=' + String(codigo) + '&Tipo=' + String(tipo)  ;
                        var vContentType = "application/json; charset=utf-8";
                        var vDataType = "json";
                        var vProcessData = true; 
                
                        $.ajax({
                        type          : vType, //GET or POST or PUT or DELETE verb
                        url           : vUrl, // Location of the service
                        data          : vData, //Data sent to server
                        contentType   : vContentType, // content type sent to server
                        dataType      : vDataType, //Expected data format from server
                        processdata   : vProcessData, //True or False
                        success       : function(msg) {//On Successfull service call
                            ServiceList(msg);                    
                        },
                        error: ServiceNotList// When Service call fails
                        });
                        
                        
                    }
                    catch(err)
                    {
                        alert(err.toString());
                    }
				}
                
                function ServiceList(result) 
                {
                    try
                    {
                        for (var i = 0; i < result.length; i++) 
                        { 
                            var per_venta = 0.00;   
                            if( result[i].vp != 0 )
                            {
                                per_venta = ( result[i].ve / result[i].vp ) * 100; 
                            }
                            else
                            {
                                per_venta = 0.00;
                            }
                            
                            var per_cobro = 0.00;   
                            if( result[i].cp != 0 )
                            {
                                per_cobro = ( result[i].ce / result[i].cp ) * 100; 
                            }
                            else
                            {
                                per_cobro = 0.00;
                            }
                            
                            result[i].per_venta = String(per_venta.toFixed(2)) + "%"; 
                            result[i].per_cobro = String(per_cobro.toFixed(2)) + "%";
                        }
                        
                        dataVendedores = new kendo.data.DataSource({
                            data: result
                        });
                        
                        $("#custom-listview").data("kendoMobileListView").setDataSource(dataVendedores);
                    }
                    catch(err)
                    {
                         alert(error.toString());   
                    }
                     
                }

                function ServiceNotList(result) 
                {
                    alert("Error en conexi√≥n.");
                }
                
                function listClick(var1) 
            	{
                    var tipo = getType(var1);
                    if( tipo == 30 )
                    {
                        alert("No hay detalles que mostrar.");    
                    }
                    else
                    {
                        callWebServiceList(var1, tipo);    
                    }  
                }
                
                function getType(code) 
                {
                    switch(code)
                    {
                        case 1000:
                            return 40;
                        case 100:
                        case 200:
                        case 300:
                        case 400:
                        case 500:
                        case 600:
                        case 700:
                        case 800:
                            return 10;
                        case 110:
                        case 120:
                        case 130:
                        case 140:
                        case 150:
                        case 160:
                        case 210:
                        case 220:
                        case 230:
                        case 240:
                        case 250:
                        case 260:
                        case 270:
                        case 280:
                        case 310:
                        case 320:
                        case 330:
                        case 340:
                        case 350:
                        case 410:
                        case 420:
                        case 430:
                        case 440:
                        case 450:
                        case 460:
                        case 470:
                        case 480:
                        case 490:
                        case 490:
                        case 492:
                        case 510:
                        case 520:
                        case 610:
                        case 620:
                        case 710:
                        case 720:
                        case 730:
                        case 740:
                        case 810:
                        case 820:
                            return 20;
                        default:
                            return 30;
                    }
                }
            </script>
        </div>
        
        <div id="tabstrip-reportes" 
             data-title="Reportes" 
             data-role="view"
             data-layout ="tabstrip-layout"
             data-transition="fade"
             data-init="initReportes"
             >
            <div data-role="header">
                <div data-role="navbar" style="background-color: black; color: white;">
                    <span data-role="view-title">Reportes</span>
                </div>
            </div>
            
            <ul id="custom-listview-report"></ul>    
            
            <script type="text/x-kendo-template" id="customListViewTemplate-report">
    			<div class="container_list">
                <div class="report_title">
            		<table style="width: 100%">
                    	<tr>
                        	<td style="width: 70%; text-align:left;">
            					${name}
            				</td>
                            <td style="width: 70%; text-align:right;">
                    			<a class="button" data-role="button" onclick="reportClick(${id},${col});" style="background-color: black; color: white; font-size:.7em;">Ver</a>        
            				</td>
            			</tr>
            		</table>
                </div>
    			<div class="report_descp">
            		${des}	
                </div>
                 <br />
                </div>
			</script>
            
            <script>
               function restartReportes()
               {
                   callWebServiceReprotes(); 
               }
               function initReportes(e) 
               {
                   callWebServiceReprotes(); 
               }
               function reportClick(index,col)
               {
                   param_index = index;
                   param_col = col;
                   
                   if( col == 1 )
                   {
                       app.navigate("Reporte001.html");
                       callWebServiceDeitel001(index,col);
                   }
                   else if( col == 2 )
                   {
                       app.navigate("Reporte002.html");
                       callWebServiceDeitel002(index,col);
                   }
                   else if( col == 3 )
                   {
                       app.navigate("Reporte003.html"); 
                       callWebServiceDeitel003(index,col);
                          
                   }else if( col == 4 )
                   {
                       app.navigate("Reporte004.html");    
                   }
                   else if( col == 5 )
                   {
                       app.navigate("Reporte005.html");    
                   }
                   //callWebServiceDeitel(index,col);
               }
                
               function callWebServiceReprotes() 
               {
                    try
                    {
                        var repType = "GET";
                        var repUrl = "http://portal.diapa.net:120/SellsMachineRoom/Services/WS04.svc/list";
                        var repData = 'Codigo=' + String(id) ; 
                        var repContentType = "application/json; charset=utf-8";
                        var repDataType = "json";
                        var repProcessData = true; 
                
                        $.ajax({
                        type          : repType, //GET or POST or PUT or DELETE verb
                        url           : repUrl, // Location of the service
                        data          : repData, //Data sent to server
                        contentType   : repContentType, // content type sent to server
                        dataType      : repDataType, //Expected data format from server
                        processdata   : repProcessData, //True or False
                        success       : function(msg) {//On Successfull service call
                            ServiceReport(msg);                    
                        },
                        error: ServiceNotReport// When Service call fails
                        });
                    }
                    catch(err)
                    {
                        alert(err.toString());
                    }
			   }
                
               function ServiceReport(result) 
               {
                    try
                    {
                        $("#custom-listview-report").kendoMobileListView({
                        dataSource: kendo.data.DataSource.create({data: result }),
                        template: $("#customListViewTemplate-report").html(),
                        });
                    }
                    catch(err)
                    {
                         alert(error.toString());   
                    }
               }

               function ServiceNotReport(result) 
               {
                    alert("Error en conexi√≥n.");
               }
            </script>
        </div>
        
        <div id="tabstrip-ajustes" 
             data-title="Ajustes" 
             data-role="view"
             data-layout ="tabstrip-layout"
             data-transition="fade"
             data-init="initAjustes"
             >
            <div data-role="header">
                <div data-role="navbar" style="background-color: black; color: white;">
                    <span data-role="view-title">Ajustes</span>
                    
                </div>
            </div>
            
        </div>
        
        <!--Layout-->
        <div data-role="layout" data-id="tabstrip-layout" >

            <!--Header
            <div data-role="header">
                <div data-role="navbar">
                    <span data-role="view-title"></span>
                </div>
            </div>
            -->
            <!--Footer-->
            <div data-role="footer">
                <div data-role="tabstrip">
                    <a href="#tabstrip-home" data-icon="home">Inicio</a>
                    <a href="#tabstrip-vendedores" data-icon="contacts">Vendedores</a>
                    <a href="#tabstrip-reportes" data-icon="organize">Reportes</a>
                    <a href="#tabstrip-ajustes" data-icon="settings">Ajustes</a>
                </div>
            </div>
        </div>
    </body>
</html>